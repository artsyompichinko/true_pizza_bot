<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Сотрудники</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
{% with messages = get_flashed_messages() %}
  {% if messages %}
    <ul class="flashes">
      {% for message in messages %}
        <li>{{ message }}</li>
      {% endfor %}
    </ul>
  {% endif %}
{% endwith %}
<body>
    <h1>Страница сотрудников</h1>
    <form method="post" action="/employees">
        <!-- Форма для добавления сотрудника -->
        <label for="telegram_id">Телеграм ID:</label>
        <input type="text" name="telegram_id" required>

        <label for="full_name">ФИО:</label>
        <input type="text" name="full_name" required>

        <label for="birth_date">Дата рождения:</label>
        <input type="date" name="birth_date" required>

        <label for="position">Должность:</label>
        <input type="text" name="position" required>

        <label for="phone_number">Номер телефона:</label>
        <input type="tel" name="phone_number" required>

        <input type="submit" value="Добавить сотрудника">
    </form>

    <table border="1">
        <tr>
            <th>ID</th>
            <th>Телеграм ID</th>
            <th>ФИО</th>
            <th>Дата рождения</th>
            <th>Должность</th>
            <th>Номер телефона</th>
            <th>Действия</th>
        </tr>
        {% for employee in employees_data %}
        <tr>
            <td>{{ employee.id }}</td>
            <td>{{ employee.telegram_id }}</td>
            <td>{{ employee.full_name }}</td>
            <td>{{ employee.birth_date }}</td>
            <td>{{ employee.position }}</td>
            <td>{{ employee.phone_number }}</td>
            <td>
                <!-- Кнопка "Удалить" с подтверждением через JavaScript -->
                <button onclick="confirmDelete('{{ url_for('delete_employee', id=employee.id) }}')">Удалить</button>
            </td>
        </tr>
        {% endfor %}
    </table>

    <!-- Модальное окно подтверждения удаления -->
    <div id="confirmationModal">
        <p>Вы уверены, что хотите удалить сотрудника?</p>
        <button onclick="deleteEmployee()">Да, удалить</button>
        <button onclick="cancelDelete()">Отмена</button>
    </div>
    <a href="{{ url_for('index') }}">Вернуться на главную страницу</a>
    <script>
        function clearForm() {
            // Очистка полей ввода после отправки формы
            document.getElementById('telegram_id').value = '';
            document.getElementById('full_name').value = '';
            document.getElementById('birth_date').value = '';
            document.getElementById('position').value = '';
            document.getElementById('phone_number').value = '';
        }
    </script>
   <script>
    // JavaScript-функции для управления модальным окном
    function confirmDelete(deleteUrl) {
        // Показываем модальное окно
        document.getElementById('confirmationModal').style.display = 'block';
        // Сохраняем URL для удаления в атрибуте data-delete-url
        document.getElementById('confirmationModal').setAttribute('data-delete-url', deleteUrl);
    }

    function deleteEmployee() {
        // Получаем URL для удаления из атрибута data-delete-url
        var deleteUrl = document.getElementById('confirmationModal').getAttribute('data-delete-url');

        // Отправляем запрос DELETE на сервер
        fetch(deleteUrl, {
            method: 'POST',
        })
        .then(response => response.json())
        .then(data => {
            // После успешного удаления перезагружаем страницу
            if (data.status === 'success') {
                window.location.reload();
            }
        })
        .catch(error => {
            console.error('Error:', error);
        });
    }

    function cancelDelete() {
        // Скрываем модальное окно
        document.getElementById('confirmationModal').style.display = 'none';
    }
  </script>
</body>

</html>
